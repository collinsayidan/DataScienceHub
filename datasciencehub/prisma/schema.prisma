datasource db { provider = "postgresql" url = env("DATABASE_URL") }

generator client { provider = "prisma-client-js" }

enum Role { ADMIN CREATOR MEMBER TUTOR }
enum Difficulty { BEGINNER INTERMEDIATE ADVANCED }
enum Track { SQL PYTHON ML DS PRODUCT BI CLOUD }

model User {
  id            String   @id @default(cuid())
  email         String   @unique
  name          String?
  image         String?
  role          Role     @default(MEMBER)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  progress      Progress[]
}

model Project {
  id           String      @id @default(cuid())
  title        String
  slug         String      @unique
  summary      String
  track        Track
  difficulty   Difficulty
  coverImage   String?
  datasetUrl   String?
  schemaJson   Json?
  steps        Step[]
  authorId     String?
  published    Boolean     @default(false)
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
}

model Step {
  id         String   @id @default(cuid())
  projectId  String
  index      Int
  title      String
  contentMdx String
  durationMin Int      @default(10)
  Project    Project   @relation(fields: [projectId], references: [id])
  @@unique([projectId, index])
}

model Progress {
  id         String   @id @default(cuid())
  userId     String
  projectId  String
  completedSteps Int  @default(0)
  totalSteps Int      @default(0)
  startedAt  DateTime @default(now())
  completedAt DateTime?
  lastStepIndex Int?
}
